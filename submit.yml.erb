<%-
  ppn             = num_cores.to_i
  base_slurm_args = ["--nodes", "1", "--ntasks-per-node", "#{ppn}"]

  slurm_args = case node_type
              when "gpu"
                base_slurm_args += ["--gpus-per-node", "1"]
              when "gpu-40core"
                base_slurm_args += ["--gpus-per-node", "1", "--constraint", "40core"]
              when "gpu-48core"
                base_slurm_args += ["--gpus-per-node", "1", "--constraint", "48core"]
              when "any-40core"
                base_slurm_args += ["--constraint", "40core"]
              when "any-48core"
                base_slurm_args += ["--constraint", "48core"]
              when "hugemem"
                base_slurm_args += ["--partition", "hugemem", "--exclusive"]
              when "largemem"
                base_slurm_args += ["--partition", "largemem", "--exclusive"]
              # handled in the script.queue_name below. Need to change when Owens switches to Slurm
              # when "debug"
              #   base_slurm_args += ["--partition", "debug", "--exclusive"]
              else
                base_slurm_args
              end

  torque_args = case node_type
              when "gpu"
                ":ppn=#{ppn}:gpus=1"
              when "hugemem"
                ppn == 80 ? ":ppn=#{ppn},mem=2989GB" : ":ppn=#{ppn}"
              else
                ":ppn=#{ppn}"
              end

-%>
---
batch_connect:
  template: "basic"
script:
  <%- if node_type == "debug" -%>
  queue_name: "debug"
  <%- end -%>
  native:
    <%- if cluster == 'owens' %>
    resources:
      nodes: "1<%= torque_args %>"
    <%- else %>
    <%- slurm_args.each do |arg| %>
    - "<%= arg %>"
    <%- end %>
    <%- end %>